---
id: ba-8105
status: open
deps: [ba-dca5]
links: []
created: 2026-01-29T18:11:02Z
type: task
priority: 1
assignee: vot3k
parent: ba-3d4c
---
# Implement host status and health endpoints

## Objective
Implement host resource reporting and health check endpoints. This is new functionality — the existing codebase has no host resource monitoring.

## Location
- New file: internal/api/host.go (or add to handlers.go)

## Implementation Details

### GET /v1/host/status — Host Resource Status
Response:
```json
{
  "data": {
    "hostname": "host-a",
    "total_cpus": 16,
    "used_cpus": 4,
    "total_memory_mb": 32768,
    "used_memory_mb": 8192,
    "available_memory_mb": 24576,
    "running_vms": 3,
    "total_vms": 5,
    "uptime_seconds": 86400,
    "load_average": [0.5, 0.3, 0.2]
  }
}
```

**Implementation (Linux-specific):**
1. **Hostname**: os.Hostname()
2. **Total CPUs**: runtime.NumCPU()
3. **Used CPUs**: Sum CPUs of all running VMs (iterate vm.List, sum CPUs where state=running)
4. **Total Memory**: Parse /proc/meminfo for MemTotal
5. **Used Memory (by VMs)**: Sum MemoryMB of all running VMs
6. **Available Memory**: Parse /proc/meminfo for MemAvailable
7. **Running/Total VMs**: Count from vm.List()
8. **Uptime**: Parse /proc/uptime
9. **Load Average**: Parse /proc/loadavg

**Helper functions needed:**
```go
func getHostMemoryInfo() (totalMB, availableMB int, err error)   // Parse /proc/meminfo
func getHostUptime() (float64, error)                             // Parse /proc/uptime
func getLoadAverage() ([3]float64, error)                         // Parse /proc/loadavg
```

### GET /v1/host/config — Host VMM Configuration
1. Return the current config.Config struct as JSON
2. Redact any sensitive paths if needed (v1: no sensitive data in config)
3. Return 200

### GET /v1/health — Health Check
Lightweight endpoint for monitoring:
```json
{
  "data": {
    "status": "healthy",
    "version": "0.3.0"
  }
}
```
1. Check Firecracker binary exists and is executable
2. Check data directory is writable
3. Return "healthy" or "degraded" with reason
4. Include version info (same build-time variables as vmm version)

## Implementation Notes
- /proc parsing is Linux-only but that's fine — Firecracker only runs on Linux
- Memory "used by VMs" is the sum of configured VM memory, not actual RSS
- CPU "used by VMs" is the sum of configured vCPUs, not actual utilization
- Health check must be fast (<10ms) — used for frequent polling by orchestrator
- Build-time version variables need to be accessible from internal/api package
  (either pass at construction or use a package-level var set by main.go)

## Acceptance Criteria
- /v1/host/status returns real CPU/memory data from /proc
- VM resource usage is computed from running VM configurations
- /v1/health responds in <10ms
- /v1/host/config returns the full config (matches vmm config show output)

## Acceptance Criteria

/v1/host/status returns real CPU/mem data; /v1/health responds <10ms; /v1/host/config matches config

