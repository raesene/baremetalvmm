---
id: ba-24d7
status: open
deps: [ba-8faf, ba-dec6]
links: []
created: 2026-01-29T18:14:34Z
type: feature
priority: 3
assignee: vot3k
parent: ba-0cdb
---
# Add image synchronization endpoint (stretch goal)

## Objective
Enable the orchestrator to push rootfs/kernel images to hosts that don't have them. This is a stretch goal for Phase 3.

## Location
- New endpoint in internal/api/handlers.go: POST /v1/images/upload
- New command in cmd/vmm-ctl/main.go: vmm-ctl image push

## Implementation Details

### API Endpoint: POST /v1/images/upload
- Accept multipart/form-data with image binary
- Fields: name (string), type (rootfs|kernel)
- Stream directly to disk (don't buffer entire image in memory)
- Return 201 on success

### CLI Command: vmm-ctl image push <name> --host=<host|all>
1. Find the image on a source host (or local filesystem)
2. Stream it to the target host(s) via POST /v1/images/upload
3. Show progress (bytes transferred)
4. Verify checksum after upload

### Size Considerations
- Rootfs images: 500MB - 4GB
- Kernel images: ~10MB
- Must stream, not buffer (use io.Copy with multipart writer)
- Consider chunked transfer or resumable uploads for reliability

### Alternative: Simple rsync wrapper
For v1, a simpler approach might be a vmm-ctl wrapper that uses rsync/scp between hosts, avoiding the need for a large file upload API endpoint. Document both approaches.

## Acceptance Criteria
- Images can be transferred from orchestrator to any host
- Large files (>1GB) stream without buffering in memory
- Progress is displayed during transfer
- Errors result in cleanup (no partial images)

## Acceptance Criteria

Images transfer without memory buffering; progress displayed; partial uploads cleaned up

