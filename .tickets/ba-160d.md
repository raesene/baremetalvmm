---
id: ba-160d
status: open
deps: [ba-acca]
links: []
created: 2026-01-29T18:13:15Z
type: task
priority: 0
assignee: vot3k
parent: ba-0380
---
# Create vmm-ctl CLI binary with all commands

## Objective
Create the vmm-ctl CLI binary — the user-facing interface for multi-host VM management.

## Location
- New file: cmd/vmm-ctl/main.go

## Implementation Details

### CLI Framework
Use github.com/spf13/cobra (already a dependency) for consistency with vmm CLI.

### Command Tree
```
vmm-ctl
├── host
│   ├── list          List registered hosts and their status
│   ├── add <name> <address>  Register a new host
│   └── remove <name>         Unregister a host
├── create <name>     Create VM (auto-placed or --host=X)
│   Flags: --cpus, --memory, --disk, --ssh-key, --dns, --image, --kernel, --host
├── start <name>      Start a VM
├── stop <name>       Stop a VM
├── delete <name>     Delete a VM
│   Flags: -f / --force
├── list              List all VMs across all hosts
│   Flags: -a / --all (include stopped)
├── ssh <name>        SSH into a VM
│   Flags: -u / --user (default: root)
├── status            Cluster-wide summary
└── version           Version info
```

### Command Implementations

**vmm-ctl host list:**
1. Load orchestrator config
2. Call orchestrator.ListHosts()
3. Print table: NAME | ADDRESS | STATUS | VMs | CPUs (used/total) | MEM (used/total)

**vmm-ctl host add <name> <address>:**
1. Add host to config via orchestrator.AddHost()
2. Test connectivity (call health endpoint)
3. Print success/failure

**vmm-ctl host remove <name>:**
1. Remove host from config via orchestrator.RemoveHost()
2. Print confirmation

**vmm-ctl create <name>:**
1. Parse flags into CreateVMRequest
2. If --host specified: target that host
3. Else: auto-place via orchestrator.CreateVM()
4. Print: Created VM 'worker-1' on host 'host-a' (172.16.0.2)

**vmm-ctl start/stop/delete <name>:**
1. Call orchestrator.StartVM/StopVM/DeleteVM
2. Print result with host info

**vmm-ctl list:**
1. Call orchestrator.ListAllVMs()
2. Print table: HOST | NAME | STATE | CPUs | MEM | IP | CREATED

**vmm-ctl ssh <name>:**
1. Resolve VM to host via orchestrator.ResolveVM()
2. Get host address (need to know the reachable IP for the VM)
3. Note: SSH target is the VM's IP on the host's local subnet — not directly reachable from orchestrator
4. For v1: exec ssh to the host, then vmm ssh from there
5. OR: if VMs have port forwarding for SSH on the host's public IP, use that
6. This needs design discussion — document the limitation

**vmm-ctl status:**
1. Call orchestrator.ClusterStatus()
2. Print summary: total hosts, healthy hosts, total VMs, running VMs, CPU/memory usage

### Global Flags
```
--config PATH    Path to vmm-ctl config file (default: ~/.config/vmm-ctl/config.json)
--output FORMAT  Output format: table (default), json
```

### Output Formatting
- Default: human-readable table (use tabwriter)
- --output=json: machine-readable JSON
- Use same table patterns as vmm list for visual consistency

### Build-Time Variables
```go
var (
    version = "dev"
    commit  = "unknown"
    date    = "unknown"
)
```

## Acceptance Criteria
- All commands listed in RFC are implemented
- vmm-ctl host list shows health status for each host
- vmm-ctl create auto-places VMs when --host is omitted
- vmm-ctl list shows VMs from all hosts in one table
- --output=json produces machine-readable output
- Helpful error messages when config is missing or hosts are unreachable

## Acceptance Criteria

All RFC commands work; host list shows health; create auto-places; list aggregates across hosts

