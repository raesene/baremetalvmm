---
id: ba-d968
status: open
deps: []
links: []
created: 2026-01-29T18:09:59Z
type: task
priority: 1
assignee: vot3k
parent: ba-3d4c
---
# Implement JSON response envelope types

## Objective
Create internal/api/responses.go with the consistent JSON envelope used by all API endpoints.

## Location
- New file: internal/api/responses.go

## Implementation Details

Define the response envelope types:
```go
// APIResponse is the standard envelope for all responses
type APIResponse struct {
    Data  interface{} `json:"data"`
    Error *APIError   `json:"error"`
}

type APIError struct {
    Code    string `json:"code"`    // machine-readable: "vm_not_found", "invalid_request", etc.
    Message string `json:"message"` // human-readable description
}
```

Provide helper functions:
- `WriteJSON(w http.ResponseWriter, status int, data interface{})` — writes success response with status code
- `WriteError(w http.ResponseWriter, status int, code, message string)` — writes error response
- Use `encoding/json.NewEncoder(w)` for streaming writes (no intermediate buffer)
- Set `Content-Type: application/json` header in both helpers

## Error Codes
Define constants for standard error codes:
- `ErrCodeNotFound` = "not_found"
- `ErrCodeInvalidRequest` = "invalid_request"
- `ErrCodeConflict` = "conflict" (e.g., VM name already exists)
- `ErrCodeInternal` = "internal_error"
- `ErrCodeVMNotRunning` = "vm_not_running"
- `ErrCodeVMAlreadyRunning` = "vm_already_running"

## Acceptance Criteria
- All response types are defined with proper JSON tags
- WriteJSON and WriteError helpers produce correct envelope format
- Error codes are constants, not string literals in handler code
- Unit tests verify JSON serialization matches RFC examples

## Acceptance Criteria

Unit tests verify JSON envelope format matches RFC spec

